<!--
Shows details for a feature. Allows user to switch between layers that have results,
and collates multiple hits per layer into one view       
-->
<rv-content-pane
    close-panel="self.closeDetails()"
    static-content="true"
    floating-header="true"
    is-loading="self.display.isLoading"
    hide-when-loading="self.display.data.length === 1 || !self.display.data">

    <!-- this handles the case of only one layer returning results. hides the side selector  -->
    <div class="rv-details" ng-if="self.display.data.length === 1">
        <md-content class="rv-details-data rv-content" rv-detect-scrollbar>
            <div class="rv-subsection">
                <div class="rv-subheader">
                    <h4 class="md-subhead">{{ self.display.data[0].requester }}</h4>
                </div>

                <div class="rv-subcontent">
                    <h5 class="rv-sub-subhead" ng-repeat-start="item in self.display.data[0].data">{{ item.name }}</h5>

                    <p ng-repeat-end ng-repeat="paragraph in item.data">
                        {{ paragraph }}
                    </p>

                </div>

            </div>
        </md-content>
    </div>

    <!-- this handles the case of multiple layers returning results. shows the side selector  -->
    <div class="rv-details rv-multiple" ng-if="self.display.data.length > 1">
        <!-- the detail content  -->
        <md-content class="rv-details-data rv-content" rv-detect-scrollbar>
            <div
                class="rv-subsection rv-hide-animate"
                ng-class="{ 'rv-hide': (self.display.data.length > 1 && self.selectedItem.isLoading) || !self.display.data }">
                <div class="rv-subheader">
                    <h4 class="md-subhead">{{ self.selectedItem.requester }}</h4>
                </div>

                <div class="rv-subcontent">
                    <!-- Feature Key-Value list presentation  -->
                    <div ng-if="self.selectedItem.format === 'EsriFeature'">
                        <h5 class="rv-sub-subhead" ng-repeat-start="item in self.selectedItem.data">{{ item.name }}</h5>

                        <ul ng-repeat-end class="rv-details-zebra-list">
                            <li ng-repeat="keyval in item.data">
                                <div class="rv-details-attrib-key">{{ keyval.key }}</div>
                                <div class="rv-details-attrib-value">{{ keyval.value }}</div>
                            </li>
                        </ul>
                    </div>

                    <!-- Plain text presentation  -->
                    <div ng-if="self.selectedItem.format === 'Text'">
                        <h5 class="rv-sub-subhead" ng-repeat-start="item in self.selectedItem.data">{{ item.name }}</h5>

                        <p ng-repeat-end ng-repeat="paragraph in item.data">
                            {{ paragraph }}
                        </p>
                    </div>
                </div>

            </div>
        </md-content>

        <!-- the side selector  -->
        <div
            class="rv-details-layer-list"
            ng-mouseenter="self.onEnter()"
            ng-mouseleave="self.onLeave()"
            ng-show="self.display.data.length > 1">

            <ul class="rv-list">
                <li ng-repeat="item in self.display.data">
                    <md-button
                        class="rv-button-square rv-details-layer-item"
                        ng-class="{'rv-selected': item === self.selectedItem }"
                        ng-click="self.selectItem(item)">
                        <div class="rv-symbology-item" ng-class="{ 'rv-progress' : item.isLoading }">
                            <img alt="" class="md-whiteframe-z1" ng-src="http://lorempixel.com/32/32/technics/?{{ $index }}"/>
                            <md-progress-circular md-diameter="48" class="md-primary" md-mode="{{ item.isLoading ? 'indeterminate' : '' }}"></md-progress-circular>
                            <span class="rv-symbology-item-name">{{ item.requester }}</span>
                        </div>
                    </md-button>
                </li>
            </ul>

        </div>
    </div>

</rv-content-pane>
