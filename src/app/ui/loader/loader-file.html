<rv-content-pane
    flow-drag-enter="self.dropActive = true"
    flow-drag-leave="self.dropActive = false"
    flow-prevent-drop
    class="rv-file-drop"
    ng-class="{'rv-file-drop-active': self.dropActive}">

    <div class="rv-loader-file" flow-init="{ singleFile: true }">
        <!-- add `, permanentErrors: [200, 201, 202, 404, 415, 500, 501], successStatuses: []` to flow-init to simulate error during upload  -->

        <div class="rv-file-drop-blur">

            <rv-stepper-item
                step="self.upload.step"
                form="self.upload.form"
                summary-value="{{ self.upload.file && self.upload.step.isCompleted ? self.upload.file.name : 'GeoJSON, CSV, or Shapefile' }}">

                <md-input-container class="md-block rv-loader-file-em" flex>
                    <div
                        flow-files-submitted="self.upload.filesSubmitted($files, $event, $flow)"
                        flow-file-success="self.upload.fileSuccess($file, $flow)"
                        flow-error="self.upload.fileError($file, $message, $flow)">

                        <md-button
                            class="rv-button-square rv-loader-file-select-button"
                            flow-btn
                            flow-progress="console.log()"
                            ng-click="self.upload.fileSelectorOpened()">Select a file</md-button>

                        <md-progress-linear md-mode="determinate" value="{{ self.upload.file ? self.upload.file.progress() * 100 : 0 }}"></md-progress-linear>

                    </div>
                    <div class="errors" ng-messages="self.upload.form.$error" ng-if="self.upload.form.$invalid">
                        <div ng-message="upload-error">File cannot be uploaded.</div>
                    </div>
                </md-input-container>

            </rv-stepper-item>

            <rv-stepper-item
                form="self.select.form"
                step="self.select.step"
                summary-value="{{ self.select.dataType && self.select.step.isCompleted ? self.dataTypes[self.select.dataType] : '' }}"
                is-continue-enabled="self.select.dataType">

                <!--{{ self.select.form.$valid }} {{ self.select.form.$error }}

                {{ self.select.form.dataType.$valid }} {{ self.select.form.dataType.$error }}

                {{ self.select.form.dataType }} -->

                <md-input-container class="md-block">
                    <label>Select data type</label>
                    <md-select name="dataType" ng-model="self.select.dataType" required>
                        <md-option ng-repeat="(value, key) in self.dataTypes" value="{{ value }}">
                            {{ key }}
                        </md-option>
                    </md-select>
                    <div class="errors" ng-messages="self.select.form.dataType.$error">
                        <div ng-message="required">Required</div>
                    </div>
                </md-input-container>
            </rv-stepper-item>

            <form name="self.configureLayerForm">
                <rv-stepper-item
                    step="self.steps[2]"
                    is-continue-enabled="self.configureLayerForm.$valid"
                    ng-switch
                    on="self.select.dataType">

                    {{ self.configureLayerForm.$valid }}
                    ---
                    {{ self.configureLayerForm.$error }}
                    ---
                    {{ self.configureLayerForm.layerName.$error }}

                    <md-input-container class="md-block">
                        <div ng-messages="self.configureLayerForm.$error" multiple md-auto-hide="false">
                            <div ng-message="required">required?</div>
                            <div ng-message="customKey">File cannot be uploaded.</div>
                        </div>
                    </md-input-container>

                    <md-input-container class="md-block">
                        <label>Layer Name</label>
                        <input name="layerName" ng-model="self.options.layerName" required md-maxlength="512">
                        <div ng-messages="self.configureLayerForm.layerName.$error">
                            <div ng-message="required">This is required!</div>
                            <div ng-message="md-maxlength">That's too long!</div>
                        </div>
                    </md-input-container>

                    <md-input-container class="md-block">
                        <label>Primary Field</label>
                        <md-select name="primaryField" ng-model="self.options.primaryField" required>
                            <md-option ng-repeat="(value, key) in self.fields" value="{{ value }}">
                                {{ key }}
                            </md-option>
                        </md-select>
                        <div class="errors" ng-messages="self.configureLayerForm.primaryField.$error">
                            <div ng-message="required">Required</div>
                        </div>
                    </md-input-container>

                    <div layout="row" ng-switch-when="csv">
                        <md-input-container class="md-block" flex>
                            <label>Latitude</label>
                            <md-select name="latitude" ng-model="self.options.latitude" required>
                                <md-option ng-repeat="(value, key) in self.fields" value="{{ value }}">
                                    {{ key }}
                                </md-option>
                            </md-select>
                            <div class="errors" ng-messages="self.configureLayerForm.latitude.$error">
                                <div ng-message="required">Required</div>
                            </div>
                        </md-input-container>
                        <md-input-container class="md-block" flex>
                            <label>Longitude</label>
                            <md-select name="longitude" ng-model="self.options.longitude" required>
                                <md-option ng-repeat="(value, key) in self.fields" value="{{ value }}">
                                    {{ key }}
                                </md-option>
                            </md-select>
                            <div class="errors" ng-messages="self.configureLayerForm.longitude.$error">
                                <div ng-message="required">Required</div>
                            </div>
                        </md-input-container>
                    </div>

                </rv-stepper-item>
            </form>
            <!--md-button ng-click="self.expanded = !self.expanded">
            Expand first step</md-button>

        <md-button ng-click="self.expanded2 = !self.expanded2">
            Expand second step</md-button>
        <br/>
        <md-button ng-click="self.completed = !self.completed">
            Complete first step</md-button>

        <md-button ng-click="self.completed2 = !self.completed2">
            Complete second step</md-button-->

        </div>

        <div class="rv-file-drop-container" flow-drop>
            <span class="md-display-2 rv-file-drop-title">Drop to upload your file</span>
        </div>
    </div>

</rv-content-pane>
